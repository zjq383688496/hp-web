!function(a){if(a&&window.ArtJS){ArtJS.define("ArtJS.util.overlayer",{id:"util-overlayer",status:!1,init:function(){if(!this.container){a("#"+this.id).remove();var b="z-index:9000;display:none;width:100%;height:100%;position:absolute;top:0;left:0;right:0;bottom:0;";this.container=a('<div id="'+this.id+'" style="'+b+'"></div>'),a("body").append(this.container)}},showLayer:function(a,b){return this.status?!1:(this.container||this.init(),a="undefined"!=typeof a?a:.3,b=b||"#000",this.container.stop(!0,!0).css({background:b,filter:"alpha(opacity="+100*a+")",opacity:a}),this.setSize(),void(this.status=!0))},hideLayer:function(){this.status&&(a.browser.isIE6?this.container.hide():this.container.fadeOut(),this.status=!1)},setSize:function(){this.container.css({width:a(document).width()+"px",height:a(document).height()+"px",display:"block"})},resize:function(){this.status&&(this.container.css("display","none"),this.setSize())}},function(){a(window).resize(function(){ArtJS.util.overlayer.resize()})});var b="util-dialog",c=ArtJS.lang.get(b)||{close:"关闭",closeTips:"关闭浮层",loading:"正在加载中……",loadingError:"加载失败",confirm:"确认",cancel:"取消",alert:"提醒",alertTitle:"消息提示",confirmTitle:"确认提示",promptTitle:"输入提示"};c.id=b,ArtJS.define("ArtJS.util.dialog",{id:b,status:!1,resizeStatus:!1,finishCallback:null,closeCallback:null,tmpls:{frameset:['<div id="{id}">','<div class="pdb-bgt"><span></span></div>','<div class="pdb-bgm"></div>','<div class="pdb-main">','<div class="pdb-title"><h4></h4><span class="close" onclick="ArtJS.util.dialog.close();" title="{closeTips}">{close}</span></div>','<div class="pdb-content"><div class="pdb-contentframe"></div></div>','<div class="pdb-bottom"></div>',"</div>",'<div class="pdb-bgb"><span></span></div>',"</div>"].join(""),titletab:'<span data-url="{url}" data-width="{width}" data-height="{height}">{title}</span>',bottom:'<p class="pdb-bottom-action"><a class="btn btn-action"><em>{confirm}</em></a><a class="btn btn-cancel"><em>{cancel}</em></a></p><p class="pdb-bottom-text"></p>',loading:'<p class="txt-loading-32" style="margin-top:{marginTop}px;">{loadingText}</p>',alert:'<div class="msg-{type} f14">{message}</div><div class="tac pb20"><a class="btn btn-cancel" onclick="ArtJS.util.dialog.close();"><em>{close}</em></a></div>',confirm:'<div class="msg-confirm f14">{message}</div>',prompt:'<div class="p20 f14">{content}</div>',inputelm:'<dl class="prompt clearfix"><dt>{title}</dt><dd><input type="text" class="txt-input" /></dd></dl>',iframe:'<iframe id="{iframeId}" name="{iframeId}" src="about:blank" width="100%" height="{height}px" scrolling="auto" frameborder="0" marginheight="0" marginwidth="0"></iframe>',error:'<div class="p20"><p class="txt-error">{loadingError}</p></div>',ajaxload:'<p class="txt-loading-32" style="margin-top:{height}px;">&nbsp;</p>'},init:function(){ArtJS.ready(function(){ArtJS.util.dialog._init()})},_init:function(){this.container||(a("#"+this.id).remove(),this.container=a(this.tmpls.frameset.substitute(c)),a("body").append(this.container))},open:function(a){ArtJS.ready(function(){ArtJS.util.dialog._open(a)})},_open:function(b){this.status&&this.lastContentId&&(a("body").append(a("#"+this.lastContentId)),a("#"+this.lastContentId).hide(),this.lastContentId=null),ArtJS.util.overlayer.showLayer(b.op,b.overbg),this.container||this._init(),this.options=b,b.callback&&(this.finishCallback=b.callback),b.closeFunction&&(this.closeCallback=b.closeFunction),b.title?(this.container.find(".pdb-title").show(),this.setTitle(b.title,b.tabs)):this.container.find(".pdb-title").hide(),b.bottom?(this.container.find(".pdb-bottom").show(),this.setBottom(b.bottom)):this.container.find(".pdb-bottom").hide();var d=b.width||400,e=b.height||300,f=this;switch(b.mode||"text"){case"ajax":this.container.find(".pdb-contentframe").html(b.content.loading||this.tmpls.ajaxload.substitute({height:(e-32)/2})),this.setAutoHeight(),a.ajax({type:b.content.type||"get",url:b.content.url,data:b.content.param||"",error:function(){f.setContent(b.content.error||f.tmpls.error.substitute(c)),f.setAutoHeight(60),f.finish()},success:function(a){f.setContent(a),f.setAutoHeight()}});break;case"text":this.setContent(b.content);break;case"id":this.setContent(""),this.container.find(".pdb-contentframe").append(a("#"+b.id)),a("#"+b.id).removeClass("hidden").show(),this.lastContentId=b.id;break;case"iframe":this.iframeId="iframe_"+(new Date).getTime(),this.setContent(this.tmpls.iframe.substitute({iframeId:this.iframeId,height:e})),this.setIframe(b.url)}this.container.find(".pdb-main").css("width",d+"px"),this.container.find(".pdb-content").css("height",e+"px"),this.container.css("width",d+20+"px").show();var g=e+(b.title?this.container.find(".pdb-title").height():0)+(b.bottom?45:0);this.container.find(".pdb-bgm, .pdb-main").css("height",g+"px"),this.container.attr("class",b.css||""),this.status=!0,this.resizeStatus=!0,this.resize(),"ajax"!=b.mode&&this.finish()},finish:function(){this.finishCallback&&this.finishCallback(this.container.find(".pdb-contentframe"))},resize:function(){if(this.status&&this.resizeStatus){var b=(a(window).width()-this.container.width())/2,c=this.options.top?this.options.top:(a(window).height()-this.container.height())/2;this.container.css({left:a(document).scrollLeft()+Math.max(b,20)+"px",top:a(document).scrollTop()+Math.max(c,20)+"px"}),a.browser.isIE6&&this.container.bindJendUI("HideOverElements","select,object")}},close:function(a){ArtJS.ready(function(){ArtJS.util.dialog._close(a)})},_close:function(b){if(this.status){switch(a.browser.isIE6&&(b=""),b){case"fade":this.container.fadeOut();break;case"slide":this.container.slideUp();break;default:this.container.hide()}ArtJS.util.overlayer.hideLayer(),this.status=!1,this.lastContentId&&(a("body").append(a("#"+this.lastContentId)),a("#"+this.lastContentId).hide(),this.lastContentId=null),a.browser.isIE6&&this.container.bindJendUI("ShowOverElements","select,object"),this.closeCallback&&setTimeout(function(){ArtJS.util.dialog.closeCallback(),ArtJS.util.dialog.closeCallback=null},0)}},setStyle:function(a){ArtJS.ready(function(){ArtJS.util.dialog._setStyle(a)})},_setStyle:function(a){a.titlecolor&&this.container.find(".pdb-title").css("color",a.titlecolor),a.bgcolor&&this.container.find(".pdb-title").css("background-color",a.bgcolor),a.bordercolor&&this.container.find(".pdb-main").css("border-color",a.bordercolor)},setTitle:function(b,c){var d=this.container.find(".pdb-title h4");if(c){d.addClass("tab").html("");for(var e=0;e<c.length;e++)d.append(this.tmpls.titletab.substitute(c[e]));d.find("span:first").addClass("on"),d.find("span").click(function(){a(this).hasClass("on")||(a(this).siblings(".on").removeClass("on"),a(this).addClass("on"),ArtJS.util.dialog.setIframe(a(this).attr("data-url")),ArtJS.util.dialog.setWidth(parseInt(a(this).attr("data-width"),10)),ArtJS.util.dialog.setHeight(parseInt(a(this).attr("data-height"),10)))})}else d.removeAttr("class").html(b)},setContent:function(a){this.container.find(".pdb-contentframe").html(a)},setIframe:function(b){a("#"+this.iframeId).attr("src",b)},setBottom:function(a){a&&(a.html?this.container.find(".pdb-bottom").html(a.html):(this.container.find(".pdb-bottom").html(this.tmpls.bottom.substitute(c)),a.noteHtml&&this.container.find(".pdb-bottom .pdb-bottom-text").html(a.noteHtml),a.actionHTML?this.container.find(".pdb-bottom .pdb-bottom-action").html(a.actionHTML):(a.actionBtnText&&this.container.find(".pdb-bottom .btn-action em").html(a.actionBtnText),a.cancelBtnText&&this.container.find(".pdb-bottom .btn-cancel em").html(a.cancelBtnText))),this.container.find(".pdb-bottom .btn-action").click(a.callback?function(){a.callback()}:function(){ArtJS.util.dialog.close()}),this.container.find(".pdb-bottom .btn-cancel").click(a.cancel?function(){a.cancel()}:function(){ArtJS.util.dialog.close()}))},setWidth:function(a){a&&(a=parseInt(a,10),this.container.find(".pdb-main").css("width",a+"px"),this.container.css("width",a+20+"px"),this.resize())},setHeight:function(a){if(a){a=parseInt(a,10);var b=this.container.find(".pdb-content").height(),c=this.container.find(".pdb-main").height();this.container.find(".pdb-bgm, .pdb-main").css("height",a-b+c+"px"),this.container.find(".pdb-content").css("height",a+"px"),this.container.find(".pdb-content iframe").attr("height",a),this.resize()}},setAutoHeight:function(b){var c=Math.max(a(".pdb-contentframe").height(),b||100);this.setHeight(c)},showLoading:function(a){return a.mode="text",a.height=100,a.marginTop=(a.height-56)/2,a.loadingText=a.loadingText||c.loading,a.content=this.tmpls.loading.substitute(a),this.open(a),!1},show:function(a){return a.mode="id",this.open(a),ArtJS.ready(function(){ArtJS.util.dialog.setAutoHeight()}),!1},pop:function(a){return a.mode="iframe",this.open(a),!1},ajax:function(a){return a.mode="ajax",a.content={url:a.url},this.open(a),!1},alert:function(a){"string"==typeof a&&(a={message:a}),a.close=c.close,a.type=a.type||"alert";var b=this.tmpls.alert.substitute(a);return this.open({mode:"text",title:a.title||c.alertTitle,content:b,width:a.width||350,height:100,top:a.top,closeFunction:a.callback}),ArtJS.ready(function(){ArtJS.util.dialog.setAutoHeight()}),!1},confirm:function(b){"string"==typeof b&&(b={message:b});var d=this.tmpls.confirm.substitute(b),e=function(){ArtJS.util.dialog.close(),b.callback&&a.isFunction(b.callback)&&b.callback()},f=function(){ArtJS.util.dialog.close(),b.cancel&&a.isFunction(b.cancel)&&b.cancel()};return this.open({mode:"text",title:b.title||c.confirmTitle,content:d,bottom:{callback:e,cancel:f},width:b.width||350,height:60,top:b.top}),ArtJS.ready(function(){ArtJS.util.dialog.setAutoHeight(60)}),!1},prompt:function(b){a.isArray(b.message)||(b.message=[b.message]);for(var d=[],e=0;e<b.message.length;e++)d.push(this.tmpls.inputelm.substitute({title:b.message[e]}));var f=this.tmpls.prompt.substitute({content:d.join("")}),g=function(){var c=[];ArtJS.util.dialog.container.find("dl.prompt input").each(function(){c.push(a(this).val().trim())}),b.callback(c),ArtJS.util.dialog.close()},h=function(){ArtJS.util.dialog.close()};return this.open({mode:"text",title:b.title||c.promptTitle,content:f,bottom:{callback:g,cancel:h},width:b.width||350,height:60,top:b.top}),ArtJS.ready(function(){ArtJS.util.dialog.setAutoHeight(60)}),!1}},function(){a(window).resize(function(){ArtJS.util.dialog.resize()})}),ArtJS.debug("dialog.js","初始化成功")}}(jQuery);